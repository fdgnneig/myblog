<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta content="text/css" http-equiv="Content-Style-Type">
<title> Attify系列课程Hardware_Embedded Hacking for IoT Devices（part2）</title>
</head>
<body>
<h1 align="center" class="root">
<a name="4fq4aj5ritcia659qcsj9tqj68"> Attify系列课程Hardware_Embedded Hacking for IoT Devices（part2）</a>
</h1>
<div align="center" class="globalOverview">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/images/ Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89.jpg"></div>
<h2 class="topic">
<a name="06q2opgeu663l559vovld8s0o0">网络摄像头破解实例（uart接口）</a>
</h2>
<h3 class="topic">
<a name="1tahmh6rtepf7sjrajt2o89nvn">&nbsp;lsusb命令显示所有usb设备，目标设备usb支持uart接口</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/73c107d0poged5tcjj4i4c42bq.png"></p>
<h3 class="topic">
<a name="56dnidu2orpkq8009bisq9qotu">&nbsp;&nbsp;运行baudrate.py确定设备波特率</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/15b8l2cpmdmbcfbj471qlh6mmd.png"></p>
<h3 class="topic">
<a name="0pmo4ur6q89l0c5anohb0bvlni">&nbsp;&nbsp;&nbsp;检测到波特率，运行minicom</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/2mfef37f8h2cd7do1ou5afim4h.png"></p>
<h3 class="topic">
<a name="3svq1gl54f7o3ffr9fq9lqh76u">&nbsp;&nbsp;&nbsp;&nbsp;运行minicom后进入rootshell</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/0f01v3qnjbh043tqhfv46gftgi.png"></p>
<h2 class="topic">
<a name="7dst3rocd74lb8o1hlo7t0cbc3">NAND故障技巧</a>
</h2>
<h3 class="topic">
<a name="2fgin4s7vqph2db77nomtjieau">&nbsp;一种技巧，常用于进入bootloader或绕过安全检测机制，在设备booting up时使用，当bootloader将内核释放到内存中时，人为产生错误，由于错误，bootloader无法查找到内核并加载释放，从而返回到默认的bootloader命令行界面，由此可以更改bootloader的启动参数，引导重启设备，此方法也可以用于root设备或重写设备固件&#13;
该技巧关键在于确定bootloader何时加载并释放内核，并在该时间点触发错误并打断该过程，从而获得bootloader命令行&#13;
该技巧另一个关键在于如何触发错误，部分设备可以通过回车打断内核加载过程，本例应该是通过干扰NAND flash芯片的特定引脚，从而产生错误</a>
</h3>
<h3 class="topic">
<a name="2vrol6je338l67r4gduogavmsd">&nbsp;&nbsp;该种方法可以用于root wink hub设备，并将新固件写入设备</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/54h942h319s35u0tesv24a1qdo.png"></p>
<h3 class="topic">
<a name="44c29mrqk0nnej4b5l51o541ib">&nbsp;&nbsp;&nbsp;</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7gf1ii5ph71v9fd08fm2s7rv00.png"></p>
<h3 class="topic">
<a name="7o7bv028hlgmf7lk1a5dguq8am">&nbsp;&nbsp;&nbsp;&nbsp;wink hub设备上的一个NAND flash芯片，经过芯片datasheet分析，该三个引脚至少一个是接地的，在bootloader加载内核时，干扰该引脚可以触发错误，从而进入bootloader命令行</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/2kopspfar4s9d36mge158b7a2t.png"></p>
<h3 class="topic">
<a name="53b4io24fa0md9anbo9140sf0j">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;即该flash</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/5v1s7nk1nr8mknadkfg172fpm0.png"></p>
<h3 class="topic">
<a name="734u4vcj1mlg6mbbllffecuj60">&nbsp;第一步运行脚本确定设备波特率</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7c5go18foe48c6t6cm1409dp4l.png"></p>
<h3 class="topic">
<a name="4mgk549buclchrfhevgo07ff1j">&nbsp;&nbsp;找到正确的波特率，打开minicom</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/66k9rpamckaq7ccgij5r4ld0gs.png"></p>
<h3 class="topic">
<a name="5u3s6478s908pqb6ncj32sblqc">&nbsp;&nbsp;&nbsp;minicom启动</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7910ikkj2gjoi3il9k5vnbv9bd.png"></p>
<h3 class="topic">
<a name="06fkks64e1okrgb5ssot41ro3h">&nbsp;&nbsp;&nbsp;&nbsp;bootloader发现无法获得内核映像故报错，所以获得了bootloader的shell，该技巧关键在于确定bootloader何时加载并释放内核，并在该时间点触发错误并打断该过程，从而获得bootloader命令行&#13;
该技巧另一个关键在于如何触发错误，部分设备可以通过回车打断内核加载过程，本例应该是通过干扰NAND flash芯片的特定引脚，从而产生错误</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/6e3qn2ob3vi59u3uua5dceqgus.png"></p>
<h3 class="topic">
<a name="0f5v46b45gifuoed3pb0nu5c55">&nbsp;printenv命令可以查看到bootloader的启动参数</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/3trb5pagacvt39atiq0crvalfj.png"></p>
<h3 class="topic">
<a name="62ii45nphilpcfd7h25n4gh55u">&nbsp;&nbsp;通过在bootloader启动参数后加init=/bin/sh，并使用setenv设置环境变量，从而在设备启动后获得rootshell</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/26akhad31o1i8v7noo8vsqidrp.png"></p>
<h3 class="topic">
<a name="7s208sa217cjvne73l2uabjnud">&nbsp;&nbsp;&nbsp;</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/24v43dvjevtq84livia0hb7k45.png"></p>
<h2 class="topic">
<a name="425d6iejeklarst76etami7m90">介绍JTAG</a>
</h2>
<h3 class="topic">
<a name="0hkkfjcqlrlr65jbtkructjt7v">&nbsp;典型JTAG连接及其端口，能实现flash的读写以及固件调试，常用于获取设备权限、dump固件，获取同一个PCB板上不同芯片的访问权限，该接口在嵌入式设备中很常见，甚至比uart接口更常见</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/1drvvv16jndavr2qs77sgaiqou.png"></p>
<h3 class="topic">
<a name="4e54nluq0j2os38hvjskegeeul">&nbsp;&nbsp;JTAG文档</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/5c02ppi1imdesctddlh4hosjop.png"></p>
<h3 class="topic">
<a name="022t6ql84tf7nhbtkdltfqa77e">&nbsp;&nbsp;&nbsp;JTAG发展时间线</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/0d0nl3hquepqc7n8q13aehshu5.png"></p>
<h3 class="topic">
<a name="64rh13hg57h37cgeoqckpnkvln">&nbsp;&nbsp;&nbsp;&nbsp;JTAG用途 BYPASS等是JTAG的工作模式</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7tn3j0mj06rjfbe784kf7fvq35.png"></p>
<h3 class="topic">
<a name="5quei784a5otsvb3l3gd8a70ko">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JTAG示例，图中五个FPGA设备可以使用JTAG相连，无需测试每个FPGA设备，而是使用一行JTAG命令即可访问不同的FPGA设备</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/20s2ul8tdnp1oi25u1q5bv9es2.png"></p>
<h3 class="topic">
<a name="39fjmpsn3mh45bnrj3gas88lu4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;强烈推荐图中连接用于学习tjag技术概述</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/6h8vs3q2t6mg8goltbaak9vm5p.png"></p>
<h3 class="topic">
<a name="386kdgrnjdd4p30103a6285090">&nbsp;JTAG数据输入的延迟由时钟周期决定</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/3a2fc1b7s5ds3dvsajakmu5n4e.png"></p>
<h3 class="topic">
<a name="5ncv7qtpo774i5u7j53ejja8jk">&nbsp;&nbsp;BSDL 边界扫描描述语言，其是VHDL的一个子集具体描述见链接</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7885pgveb5aisl90hge9g6djoc.png"></p>
<h3 class="topic">
<a name="3dgl9f06h672m1sbl1g5lpkprg">&nbsp;&nbsp;&nbsp;jtag常被破坏，故需要对其进行识别，可以使用识别工具</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/385hi36appit25t8ce4usgvi0u.png"></p>
<h3 class="topic">
<a name="6oag4nkun87orrj5knq25fc4lp">&nbsp;&nbsp;&nbsp;&nbsp;jtag接口实际形状，可以使用万用表测量接口实际功能（通过测通断等方法）</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7qfd0dp57oe8jdmhvn64gfui78.png"></p>
<h3 class="topic">
<a name="52puf04vkh4f6m48bt7orcno05">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jtag接口实际形状，可以使用万用表测量接口实际功能（通过测通断等方法），注意jtag口的编号顺序不是u型的</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/724b11iodbcmfhpn2c9nj78131.png"></p>
<h3 class="topic">
<a name="0ope1ccs2psq8nlp0hp058r1uc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;识别JTAG后，使用JTAGulatork可以确定具体JTAG引脚的功能，JTAGulator上标识了具体功能的引脚，可以与设备的JTAG引脚相连，JTAGulator本身可以和笔记本相连，从而访问流终端，在该终端中确定设备具体引脚功能</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/3b9f2044ckte3le2h22up7p22s.png"></p>
<h2 class="topic">
<a name="5mv8lukkh2o6ngjl6vp4tfd02b">使用Arduino Nano和JTAGEnum识别JTAG各个接口（识别stm32上的JTAG各个接口）</a>
</h2>
<h3 class="topic">
<a name="6ulp6lru04n34fta0f9kg7vk9k">&nbsp;关于Arduino Nano</a>
</h3>
<h3 class="topic">
<a href="https://blog.csdn.net/malcolm_110/article/details/95320094" name="6mrf9shgbefh5m5sdk3q9rb0mr">&nbsp;&nbsp;https://blog.csdn.net/malcolm_110/article/details/95320094</a>
</h3>
<h3 class="topic">
<a name="0ebgdoe3i8e0t6rjt3cen7da8j">&nbsp;Arduino Nano和两根杜邦线识别STM32上的JTAG接口</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/6s0310as177qcg7h120okqlso5.png"></p>
<h3 class="topic">
<a name="2gnd7om8233pe7fsiqp52qn15i">&nbsp;&nbsp;连接STM32的JTAG中的CLK引脚</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/6e747lmvahupsf6upm1sg9g0s1.png"></p>
<h3 class="topic">
<a name="55ajmisk7n9j6vvah0h44od9p5">&nbsp;&nbsp;&nbsp;连接STM32的IO引脚</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/4rffp4mumtkkr47846q8hhd65e.png"></p>
<h3 class="topic">
<a name="61pfkehml6uvgt39ht5a1n1ldk">&nbsp;&nbsp;&nbsp;&nbsp;连接STM32的GND引脚</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/5u6k5lpasdkoro3ted4cbv2hfr.png"></p>
<h3 class="topic">
<a name="16id4ecdku0dv81lig1rjnpqia">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;连接STM32的A15引脚</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7nfbg5bsilkt8ms6pdgt1v1p56.png"></p>
<h3 class="topic">
<a name="54jv0r7kgdopfh01tukbdenrpv">&nbsp;连接STM32的B3引脚</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/6ksn3gjruos70j78q3ial7qbrh.png"></p>
<h3 class="topic">
<a name="30m2l5setet1l7esuo40moj3kh">&nbsp;&nbsp;连接任意两个STM32引脚</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/71930cagla3hrha8ruc8tbvttc.png"></p>
<h3 class="topic">
<a name="6tiogmv0hlki77qskchsdm6q1m">&nbsp;&nbsp;&nbsp;将STM32与Arduino的地线相连接</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/3fd0h52fia6h79mqitou0jc0es.png"></p>
<h3 class="topic">
<a name="1745ps94e3n3r5m03ja2rr19et">&nbsp;&nbsp;&nbsp;&nbsp;将STM32剩余的杜邦线全部连接到Arduino的D引脚上</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/1eudpmrh8999o6vr2k94dfbukb.png"></p>
<h3 class="topic">
<a name="35nnaqbctt15himk2u74cave97">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将stm32和Arduino使用两根线分别连接到计算机上，stm32连接到计算机的目的可能是供电，Arduino NAND连接到计算机的目的可能是与JTAGEnum交互，从而判断STM32的JTAG引脚类型</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/4o0o613tfagc4kjqev9quj5hef.png"></p>
<h3 class="topic">
<a name="7nqo5ndv2h0r4qifus54ldekfi">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;连接上电脑运行JTAGEnum，从而识别JTAG具体引脚，注意此时STM32和Arduino分别单独连接到计算机中</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/3v6e209jbj19q2d4cnupdja28u.png"></p>
<h2 class="topic">
<a name="63bc378adse93slm1rt5h4upgu">使用JTAGulatork识别JTAG具体引脚</a>
</h2>
<h3 class="topic">
<a name="7rf271pk3se3egtjtimk6rahbt">&nbsp;识别JTAG后，使用JTAGulator可以确定具体JTAG引脚的功能，JTAGulator上标识了具体功能的引脚，可以与设备的JTAG引脚相连，JTAGulator本身可以和笔记本相连，从而访问流终端，在该终端中确定设备具体引脚功能</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/0d7ollno3g7tlh300ve7265mjl.png"></p>
<h3 class="topic">
<a name="72sibor07622l19s49lhla1148">&nbsp;&nbsp;该设备共有24个channel，用于与目标设备可能的JTAG口相连，从而判断目标设备具体JTAG引脚类型，而弄清JTAG引脚定义是进行JTAG设备调试的基础</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/72g0d2gqrj2k37ugm8queldk1t.png"></p>
<h3 class="topic">
<a name="2s27vn0je1dfbl63cj7a19a6kc">&nbsp;&nbsp;&nbsp;可以通过万用表测量电压、通断的方式，从而确定具体引脚的作用</a>
</h3>
<h3 class="topic">
<a name="7cderou8j0b2q3s24f815eat6a">&nbsp;JTAGulator识别STM32中的JTAG引脚定义</a>
</h3>
<h3 class="topic">
<a name="08uq4tkv6i5bsb5ibf8n3402ln">&nbsp;&nbsp;使用杜邦线将JTAGulator的0~3四个channel和STM32的四个疑似为JTAG的引脚相连接，同时两个设备的地线也要相互连接，故两设备之间共使用了五根杜邦线进行连接，JTAGulatork需要连接到笔记本上进行数据交互，而STM32需要被供电，所以可以连接笔记本或其他供电端</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/45fbue9r2df5kb6ftbfk8mlhmc.png"></p>
<h3 class="topic">
<a name="01461ab3t928c2ptq9quogkbjj">&nbsp;&nbsp;&nbsp;连接JTAGulator终端</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/4pdo305sbtel34a9p6c5r9boi3.png"></p>
<h3 class="topic">
<a name="0g1etm5os1s45dbesg76tcaodu">&nbsp;&nbsp;&nbsp;&nbsp;进入JTAG命令行，查看可以使用的JTAG命令，如果目标设备支持uart接口，则也可以使用uart命令与其交互</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7ijikdjlstvltig26l9rct8p2n.png"></p>
<h3 class="topic">
<a name="7socn1err0fd8g4onurjg15ufe">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;设置输入输出电压，扫描JTAG接口定义</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/5rqmfaijt8kgeu9q1djm1tdf5j.png"></p>
<h3 class="topic">
<a name="3i82pkkekn75n8rvfej9afhpk0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用JTAG识别设备编号</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/20n1fkqn12q9ls6betjkp4qrhs.png"></p>
<h3 class="topic">
<a name="42iaaafp6jatv5566mc7vt62dm">&nbsp;JTAGulator识别德州仪器设备中的JTAG引脚定义</a>
</h3>
<h3 class="topic">
<a name="54qngqebb6lrf1af09rc9vnd05">&nbsp;&nbsp;</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/3g2osvppq3998uo54ltn8ui37e.png"></p>
<h3 class="topic">
<a name="5j7georhk2goi88nsd7lh80630">&nbsp;&nbsp;&nbsp;</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/63gcjbu9b0p1p4q3k4uultg8f7.png"></p>
<h3 class="topic">
<a name="33474big75m59uudq9q8s5hdfo">&nbsp;&nbsp;&nbsp;&nbsp;</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/3rg74ojjd3f5th2lav55bmoplg.png"></p>
<h3 class="topic">
<a name="0ptp8bnu12ckkfdm6khbeefrqp">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/69ubn1m606sbf2tthrhlothh80.png"></p>
<h3 class="topic">
<a name="30mngngcad7rs50mst4ufg0lfu">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;设备购买网址</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/5j7h1n8fhrlbec258rehht85in.png"></p>
<h2 class="topic">
<a name="3n51e3e466u2m0j6vdrp48bo2a">使用Attify Badge连接STM32上的JTAG</a>
</h2>
<h3 class="topic">
<a name="115bsm3qqv71majrqimuh10nje">&nbsp;</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/1vrd5o6bj7c7ge9hfnrrkvt463.png"></p>
<h3 class="topic">
<a name="7j5f613m7l1u04rbejlq6mjir9">&nbsp;&nbsp;STM32和attify badge连接时，连接引脚的对应关系</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/0nfpg3kqp6u3s5anbhqd0b8np6.png"></p>
<h3 class="topic">
<a name="5sgm5uohtf1njo1e63m77c3050">&nbsp;&nbsp;&nbsp;连接STM32的clk</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/76736jerdumev57paich0et00v.png"></p>
<h3 class="topic">
<a name="7s6vrst2je73vb9763e2e9t72e">&nbsp;&nbsp;&nbsp;&nbsp;STM32的clk连接到attify badge的D0引脚上</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/6atiuvgqpo522gsvq8fnad2d4q.png"></p>
<h3 class="topic">
<a name="78o7njcs6q115embuis2o2neh1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;连接STM32的A15</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/3klmmvv72hhjduljsc4mofmdsm.png"></p>
<h3 class="topic">
<a name="6u9lgrdtdgk09ph3b02dsna9cr">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STM32的A15连接到attify badge的D1引脚上</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/2a41essmsfuudodf7bpjtq5tls.png"></p>
<h3 class="topic">
<a name="26oticj85modpkk48v10nnpc4d">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;连接STM32的B3</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/1upcr3qfc4sn5pr0of6sgcm5p2.png"></p>
<h3 class="topic">
<a name="4s3tbfrn3gcci473u3kh7u846c">&nbsp;STM32的B3连接到attify badge的D2引脚上</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/69nk31e4qmacs6gr52upo947n9.png"></p>
<h3 class="topic">
<a name="348nkjol2cagmf11jf89akeosr">&nbsp;&nbsp;连接STM32的DIO</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/27h3rru7ei15iet94ncrr9tpnc.png"></p>
<h3 class="topic">
<a name="7ut3adoefgl4ft1kc6eqm9p9v7">&nbsp;&nbsp;&nbsp;STM32的DIO连接到attify badge的D3引脚上</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7o6efc3c9ppt241hefu3l3gk4k.png"></p>
<h3 class="topic">
<a name="6dec4lblr0r98qqsh2hvkaik29">&nbsp;&nbsp;&nbsp;&nbsp;连接STM32的GND</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/1fopapcjsmqvf9a99l8m7idsgj.png"></p>
<h3 class="topic">
<a name="3fd5c1lf2fp6p8tc5l6ngc74e2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STM32的GND连接到attify badge的GND引脚上</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/3r7bssrcaa23c6d7mc7hmkjpda.png"></p>
<h3 class="topic">
<a name="67evnnrd7bhl3br9h7sujht8cp">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将attify badge和stm32均连接到电脑上</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/5fib6g5ln25356s62me93et0d0.png"></p>
<h3 class="topic">
<a name="25lnd50u3t4ladm6ipqgbo20aq">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;两者是被一个扩展坞连接到同一个电脑上</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/5uima7q5uo69ig5i4qfjdvgh96.png"></p>
<h2 class="topic">
<a name="0cofv196b8dhisokha1b04phil">使用Attify Badge进行JTAG调试</a>
</h2>
<h3 class="topic">
<a name="0d1g0qmfrv6jg73nlhd6rqudis">&nbsp;在attify badge和STM32连接到电脑后，使用attify badge配套工具，运行main.py脚本，显示attify badge tool</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/32ckkekep1tqfbfpkf54ajn0f7.png"></p>
<h3 class="topic">
<a name="7am7eqdfg5cbnpf2nvk67lnofr">&nbsp;&nbsp;选择JTAG标签，选择STM32配置</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/3fd5d42ub8tegrhe8af5ppcj2q.png"></p>
<h3 class="topic">
<a name="45is9eng97btflejmadf17chff">&nbsp;&nbsp;&nbsp;</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/2o4q97opsna9egauoca4q4k75l.png"></p>
<h3 class="topic">
<a name="7s6dko61c2oeu4da4mm44sgrf6">&nbsp;&nbsp;&nbsp;&nbsp;连接到OpenOCD后，开启了新的终端</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/45gj5v7gmsjcvun89a1dp24hjd.png"></p>
<h3 class="topic">
<a name="3ppt4m4gcv6e0eem4i5ujqp2di">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;指定要调试的可执行文件</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/3v65mvel23p0tmmq49sads2o0f.png"></p>
<h3 class="topic">
<a name="2l5pul232pdqncfn8phdg8rq58">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开始调试程序</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7n1kl1rgb7kkb7deu9mb14ee2p.png"></p>
<h2 class="topic">
<a name="7jf6m74sr4m41bn83uh0q2uo6u">使用JTAG给设备刷入固件（在attify badge和STM32连接到电脑的基础上）</a>
</h2>
<h3 class="topic">
<a name="1a1ashvgdviap08a4tu2lpvqp9">&nbsp;OpenOCD的概念，安装和使用&#13;
https://www.cnblogs.com/dylancao/p/10330331.html</a>
</h3>
<h3 class="topic">
<a href="https://zhuanlan.zhihu.com/p/41517198" name="3qjqn4jrjpdsm0tbm2l4g2rttp">&nbsp;&nbsp;https://zhuanlan.zhihu.com/p/41517198</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/5e2rpas7msma5f76pv4qtfjhmr.png"></p>
<h3 class="topic">
<a name="1g9a9caibkv6v2akgc2ehsjqjj">&nbsp;&nbsp;&nbsp;OpenOCD-JTAG调试命令</a>
</h3>
<h3 class="topic">
<a href="https://www.cnblogs.com/zongzi10010/p/10023535.html" name="6bp5iq4tt7djdk05ntmki3ncfs">&nbsp;&nbsp;&nbsp;&nbsp;https://www.cnblogs.com/zongzi10010/p/10023535.html</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/6lf1neueee3bi046ivvp27guha.png"></p>
<h3 class="topic">
<a href="https://www.cnblogs.com/zhouliyan/p/11138070.html" name="3enp3a6rnqd048ta09k81ptdrt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://www.cnblogs.com/zhouliyan/p/11138070.html</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7u92ebjtiadsg59vld4m28jmg5.png"></p>
<h3 class="topic">
<a name="43edas7ven2089bqu8auksh5rt">&nbsp;attify badge的配置文件</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/6fnui9bpuja5qli5ntiih1bssk.png"></p>
<h3 class="topic">
<a name="4thiba2tekg6lilq2ne1ngp2kg">&nbsp;&nbsp;使用openocd通过JTAG调试stm32，并将调试命令行映射到4444端口</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/2s0tepdkgdrd6c6b90sopo9mkm.png"></p>
<h3 class="topic">
<a name="14p3nvheqbl5sd2id524kt8rfl">&nbsp;&nbsp;&nbsp;使用telnet连接444端口，即可通过OpenOCD访问STM32设备，并输入命令与其交互，从而进行设备分析和破解，通过reset init命令可以重置初始化设置</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7vqv27dbm0gru943qq527quv0q.png"></p>
<h3 class="topic">
<a name="4jag93a2phg2ooo3gtsj769v41">&nbsp;&nbsp;&nbsp;&nbsp;利用OpenOCD支持的命令，实现读写设备固件</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/2b4gcmg9qs92kmj7as8f7k64e1.png"></p>
<h2 class="topic">
<a name="0scja4o843us0j1dpagheoqdlp">通过JTAG读取内存数据</a>
</h2>
<h3 class="topic">
<a name="0h5qldad9u4n7hes7ptcpqf3j0">&nbsp;openocd中使用mdw即可读取指定地址内存数据&#13;
该命令即从地址0开始，读取32个word大小的数据</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/2fthhmsq8ee72iuse4bf437jvf.png"></p>
<h3 class="topic">
<a name="6060ti3jfeeoj41rbqk5hnagii">&nbsp;&nbsp;mdw：以32位数据为一个单位输出&#13;
mdh：以16位数据为一个单位输出 &#13;
mdb：以8位数据为一个单位输出</a>
</h3>
<h3 class="topic">
<a name="1hqd2drii5ma8spjoe56om0j01">&nbsp;&nbsp;&nbsp;通过此方法可以输出整个固件的数据，从而dump固件</a>
</h3>
<h2 class="topic">
<a name="6ke1ja25kjh8i4779gq6s27kde">通过JTAG进行内存数据dump</a>
</h2>
<h3 class="topic">
<a name="6mka28sbqeftitjstppgfnraam">&nbsp;openocd命令中，dump_image 命令后指定了dump文件的名称，dump数据的起始地址和dump苏数据的大小</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/69e7gdu4ania7vbt3aa9q51fv6.png"></p>
<h3 class="topic">
<a name="6sldlhvet1kkhgn9amah67qopt">&nbsp;&nbsp;dump数据成功</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7ilrt7a2fvu6slr70651c020gm.png"></p>
<h3 class="topic">
<a name="5nr8bp8tls874uvelnsh7fr4t3">&nbsp;&nbsp;&nbsp;分析dump出的固件</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7rsscdisa8s5im9hbq3u4fqisu.png"></p>
<h3 class="topic">
<a name="05fkn0olp64uug08hk69rerplu">&nbsp;&nbsp;&nbsp;&nbsp;输出了可能的敏感信息</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/5oiro8rqmfpplnfi4gq089taol.png"></p>
<h2 class="topic">
<a name="4ok9btnn8c6o0kpkve23vvdjmp">使用uart接口连接STM32和另一块Attify badge</a>
</h2>
<h3 class="topic">
<a name="424ras26o5deunogikbkgsftnc">&nbsp;连接STM32的a2</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/1b5aeijbtbc20flfj4b3svgjqq.png"></p>
<h3 class="topic">
<a name="08jf79fs4ssbci6tm4jh2ff0tq">&nbsp;&nbsp;将STM32的A2连接到attify badge的d1</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/1t0c78jm5h0gvqtjgjjdbkm62c.png"></p>
<h3 class="topic">
<a name="05kt2gna4hfk9pttc9nl199h0s">&nbsp;&nbsp;&nbsp;连接STM32的a3</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/1mhhsab2ns5p8i50rqhbf9m6eg.png"></p>
<h3 class="topic">
<a name="5gc5g3kq68at4hrn3kifialbjp">&nbsp;&nbsp;&nbsp;&nbsp;将STM32的A3连接到attify badge的d0</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/5gjo8s9gmv67l7a2r951amk4of.png"></p>
<h3 class="topic">
<a name="0o2f09i0l7n25puu7e4drgu7ad">&nbsp;因为此时STM32仍保持与之前一块attify badge的JTAG连接，所以GND线已经连接完毕，如果是STM32单独进行UART连接，还需要连接GND线</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/6rap8ls87od1va4i2tnnavnj05.png"></p>
<h3 class="topic">
<a name="7pj6oc8r2tm7ia11jvmidk63c4">&nbsp;&nbsp;最终一个STM32和两个Attify Badge（分别以uart和JTAG与STM32相连）通过扩展坞连接到电脑</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/4f5mhdd9t4thp316otgamfctqo.png"></p>
<h2 class="topic">
<a name="31htfrg9mb98e89v60cbsqn17d">使用JTAGT调试进行认证机制绕过</a>
</h2>
<h3 class="topic">
<a name="7u6v8ssum0r1s53kpoinv01ape">&nbsp;连接JTAG接口，设置波特率为9600</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/0tmoh1btbjb31f7a53qppn097u.png"></p>
<h3 class="topic">
<a name="63fvv7keliqq6rpvurmltq6pbi">&nbsp;&nbsp; 发现连接需要密码</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/6bb5g5llgvd9ao9ikukb7l5e40.png"></p>
<h3 class="topic">
<a name="3padf39d4mg6eaohg6u3giq147">&nbsp;&nbsp;&nbsp;使用arm-none-eabi-gdb调试存在密码验证的二进制程序，该步骤也可以使用 gdb multiarch作为调试器，这里指定了3333端口进行远程调试</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/051dcvou42nse0393bodi6uts7.png"></p>
<h3 class="topic">
<a name="32l2a6fhc5lhuu624f849ree3q">&nbsp;&nbsp;&nbsp;&nbsp;连接333端口，i r命令显示寄存器信息</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/48dtafpmj2qp9r183cbctrivv9.png"></p>
<h3 class="topic">
<a name="2256pb2r68uuleie30nc91fm6g">&nbsp;查看内存信息和函数信息，准备对关键函数下断点，从而调试</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7smqsve8db8oi59drvd0jierjh.png"></p>
<h3 class="topic">
<a name="59cj705vtpscnjteuat1nomn1a">&nbsp;&nbsp;找到关键函数并反编译</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/3gfst3vcsqe6vno2j676emu8o5.png"></p>
<h3 class="topic">
<a name="020m0u69ejkhago1kkcag55slh">&nbsp;&nbsp;&nbsp;下断点并触发断点</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/563o8qbv98mc2kdrd0putln4a7.png"></p>
<h3 class="topic">
<a name="0a1uc5iic32f975j5su4v28ef4">&nbsp;&nbsp;&nbsp;&nbsp;通过分析verifypass函数参数，发现真正的密码和我们输入的密码，此时可以通过修改寄存器值的方法，通过验证</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/35ags88o3cgi3703m1eskhaacv.png"></p>
<h2 class="topic">
<a name="6jvdemg4la4m5d5sgoi01nme9l">SPI接口通讯</a>
</h2>
<h3 class="topic">
<a name="3bk7j7ep2n87hkac1293lek584">&nbsp;该接口协议最常用于读写flash，同一个设备中可能存在多种不同的flash芯片，不同flash芯片中常用于存储不同的数据，eeprom类型的存储芯片常将spi或i2c作为读写协议</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/15ro6m7fgktt3pg8udetmgm1u2.png"></p>
<h3 class="topic">
<a name="5hnmqdos4oehpjg3bjbbaoup94">&nbsp;&nbsp;SPI接口简介</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7lanhjsqarc8c4kpcnl8eu6rcr.png"></p>
<h3 class="topic">
<a name="55tgd9ev4ohe1q8gq8n5gu3q5a">&nbsp;&nbsp;&nbsp;当从机存在ss引脚并且启动了ss引脚，该从机就会与主机通讯，主机会忽略所有其他从机</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/6m3qmjcogu44pnsov9u1ui7o41.png"></p>
<h3 class="topic">
<a name="6gdmiji1du3346kbnv57pu1m1h">&nbsp;&nbsp;&nbsp;&nbsp;分析spi引脚的flash芯片</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/178nvefuuokrvo20lbuc98pg02.png"></p>
<h3 class="topic">
<a name="0cprbisk6ksctds9v9np9oph35">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;典型的flash芯片封装方式</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/704fs6723j1uu50adkqs2rm059.png"></p>
<h3 class="topic">
<a name="09np0qloqvg0rkl11ov4mod1ie">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用该devtty0提供的脚本通过spi提取flash中的固件，一般设备固件均保存在spiflash中</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/094d34noivdop1tp3uvmjtru3k.png"></p>
<h3 class="topic">
<a name="6c73k2q2g3l8vmkn521i84s5p5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/20ophcrpu57j9d4lgbqvjv0l28.png"></p>
<h3 class="topic">
<a name="2b05jgm4jnrd8olq010tnm6u8c">&nbsp;PCB板上提供的SPI接口</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/4g789t0l3h9l15srb5rbru8eqt.png"></p>
<h3 class="topic">
<a name="4f6r6gpjovf5m3ojnknl3bhqhd">&nbsp;&nbsp;</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/4ivvr675ca2jlijot2pnigffth.png"></p>
<h3 class="topic">
<a name="43jta1k4ovftmkg0n1r06vh8b7">&nbsp;&nbsp;&nbsp;使用Attify badge连接SPI接口，注意在连接时针对Attify badge，设备的MISO连接Attify badge的MOSI,设备的MOSI连接Attify badge的MISO,但是当使用其他设备连接spi接口时，应当是MISO连MISO，MOSI连MOSI</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/47pskgna2argc2p6uoqtljp6cs.png"></p>
<h3 class="topic">
<a name="5n7mjdnj5idiq6atvql1qmtb61">&nbsp;&nbsp;&nbsp;&nbsp;VoCore是另一种开源硬件框架，若使用Attify badge连接VoCore的SPI接口，则需要将VoCore置为reset模式，其他接口连接方式一样，一旦连接完毕，即可运行spiflash.py</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/2ihjnrsqvlrnq7bjhnuq1ong66.png"></p>
<h3 class="topic">
<a name="5l163b1518t2m1pih8t0fjels2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/4mmn3d6e7pdbbpvfea7qp8oc79.png"></p>
<h3 class="topic">
<a name="2htkhskmr11njoq6vq6sinj52t">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用spiflash脚本dump固件</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/5epodldf9j4qs6831qm3ibmt04.png"></p>
<h3 class="topic">
<a name="1ae8q1rpsbr1lg1keta733lkrd">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用binwalk提取固件</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/56rn5mkkfl2cimg7vvqs8b40gq.png"></p>
<h3 class="topic">
<a name="57skt3d5pbapj6dgii29i0d113">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用迷你针夹或鳄鱼夹夹住SPI flash的引脚</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/468bgofh0fgciron5uouire4jr.png"></p>
<h2 class="topic">
<a name="774m8r1rn2mejhjbnnffnp8ka8">通过SPIdump固件</a>
</h2>
<h3 class="topic">
<a name="69mcsbnrt2m08r111qppqea9oh">&nbsp;将attify badge连接到计算机上</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/05lbf1c16t9snf5cedf09rvl0m.png"></p>
<h3 class="topic">
<a name="2m5ff5s46nie332ok9utvc8tvp">&nbsp;&nbsp;进入存在spiflash.py的目录</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/0s07567vdv70051ff7k9b69tl9.png"></p>
<h3 class="topic">
<a name="36kubfu9jujahmrc61fvue7i54">&nbsp;&nbsp;&nbsp;使用spiflash脚本dump内存</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7odljodlr7h8lkpqetkd0hi8v6.png"></p>
<h3 class="topic">
<a name="5v90boododof19h72rimuplnv8">&nbsp;&nbsp;&nbsp;&nbsp;用binwalk对固件进行文件系统提取，可以看到固件中有uboot相关区段，说明固件正常</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7hpr07tp8sj42t8ong5aj34trr.png"></p>
<h3 class="topic">
<a name="219euj6m1p6j8712lpigf8vcge">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;可以看到提取出两种不同格式的文件系统，进入squash类型的文件系统</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7jdenam570u2riugcmce8fhge0.png"></p>
<h3 class="topic">
<a name="2516qc69j0bvj01u0s571ri9ct">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;squash文件系统中有完整的linux系统目录</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/5c0cis02es6u1k09ji6fbraev2.png"></p>
<h3 class="topic">
<a name="68257eg0bn9c5ei17dllvkrh9o">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;进入jffs2文件系统</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7f4nksb686nkb97lde7mjrud62.png"></p>
<h2 class="topic">
<a name="6idkm6tmaps5mftp77bdo7vtha">总线嗅探（使用逻辑分析仪）</a>
</h2>
<h3 class="topic">
<a name="52ac5u5rcl7lv2vm9k3qolgbuq">&nbsp;在设备总线上嗅探数据</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/648dmskh7ao1pifuj86q4prq31.png"></p>
<h3 class="topic">
<a name="16lplau65sgcv9ovl2nu8toqbb">&nbsp;&nbsp;将逻辑嗅探设备接入目标设备，该设备可以分析出任何硬件通讯协议（uart spi can i2c）&#13;
即将逻辑嗅探器的一个channel连接到设备的引脚或端口，该引脚或端口应该是设备用于传输数据的&#13;
例如如果设备中有DX口，可以将其连接到逻辑嗅探器的任意一个channel上，然后将两设备GND相连，一旦嗅探开始，嗅探程序（sniffer utility）将会捕获所有正在传输的数据,该技术可以嗅探捕获设备中传输的密钥等信息，类似于wireshark抓包</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/4rd8ulbi3834j7hrk7rvh1agi6.png"></p>
<h3 class="topic">
<a name="0pescdklffhqievknqm5d1es0t">&nbsp;&nbsp;&nbsp;logic sniff utility，显示已连接</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/0avkfapqaqd32ipn41thri9tf4.png"></p>
<h3 class="topic">
<a name="5u50ff81bvlj8kn9d3ohg5sqgi">&nbsp;&nbsp;&nbsp;&nbsp;启动设备同时点击start开始嗅探</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/5etdevk8cu4hi6iffspjcrfu1f.png"></p>
<h3 class="topic">
<a name="2j4i7m5jd037nj43qr16punk1h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开始收集数据样本</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/1m4q1l0lboitog921ebq9mal1l.png"></p>
<h3 class="topic">
<a name="50hstbori4o9fsamvdv7qonskf">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;捕获到的设备bootup过程中产生的数据</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/1grdu3r4bp9mh5an1nit2sdetv.png"></p>
<h3 class="topic">
<a name="549n4fd2d4jeo3da921969dscc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;增加分析选项</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/4jcl9poq18bdqvajittt8i5de2.png"></p>
<h3 class="topic">
<a name="3s5actpcp2biifb84n36hlu3mg">&nbsp;这里分析串口通讯，不确定设备波特率，可以实验不同波特率，从而确定哪种波特率能使捕获到的数据被解析</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/4pg3rbr7bt19vb5i50r9b872h2.png"></p>
<h3 class="topic">
<a name="64pp8lk62platm6pjjme508cak">&nbsp;&nbsp;设置完数据分析后，可以看到捕获的数据被解析了</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/17gar2dnrf3beflejs9l1b9pfo.png"></p>
<h3 class="topic">
<a name="655c9esfvpem3o5djejm2t222l">&nbsp;&nbsp;&nbsp;放大数据，看到数据实际上被解码了，通过解码数据看到了uart接口相关数据</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/3i68i7e56k5popkggqfsd1dmq5.png"></p>
<h3 class="topic">
<a name="1j4p4qkem3ulco3itqk7lsbgas">&nbsp;&nbsp;&nbsp;&nbsp;可以导出嗅探解析到的数据</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/4a27risa5u5d17qni7o0crovnc.png"></p>
<h3 class="topic">
<a name="323qqm3170jtgqqu9dl5hacnh2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;对于STM32，可以将A2 A3的接口连接到逻辑嗅探器上没从而进行逻辑分析（两者GND也需要相连）</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/7fhec1q9cvl6hivd3tta28421c.png"></p>
<h3 class="topic">
<a name="3k8u2ntun7nh41fnoige2tiitc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;嗅探STM32时需要按白色复位键，从而重置设备</a>
</h3>
<p class="topicImage">
<img src="Attify%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8BHardware_Embedded Hacking for IoT Devices%EF%BC%88part2%EF%BC%89_files/5opme719ruhclk5qmo2tf1mo69.png"></p>
</body>
</html>
