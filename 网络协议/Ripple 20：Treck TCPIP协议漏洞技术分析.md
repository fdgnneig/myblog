# https://www.cnblogs.com/hetianlab/p/13298171.html
- 关键概念 ip分片 ip隧道
- 漏洞根源在于，目标tcpip协议栈中，处理IP数据包时，当ip数据包头部中表示 ip数据包总长度的字段a 小于 关键结构体中表示 分片数据包总长度的字段b时，表示实际接收到的数据比IP头部标识的IP数据包总长度要长，此时会将b设置为a，同时将表示当前分片长度的字段c也设置为a，同时，即以ip数据头中的总长度字段为准，该过程即裁剪
- 裁剪后 b=a=c，但如果此时仍存在其他分片呢，上述a=b=c的结论就不成立，故此时出现不一致性
- 即 ip数据包裁剪机制遇到ip分片的情况时，会导致不一致性
- 为了将该不一致性转为溢出，需要用到ip隧道，即将一个ip包封装在另一个ip内，此时处理ip数据包的函数在检测到该情况后，会递归调用自身，从而将内层ip数据包的字段b修改为较小值a，该字段b之后在udp处理流程中会被作为大小申请堆空间，并后期会将分片中所有数据内容循环拷贝到该对空间中，造成溢出

- 该堆溢出证明可以做到远程代码执行，具体利用方式是利用堆溢出覆盖堆首部的元数据，即堆块大小，flag等数据，进而做到任意地址分配，从而在栈上分配一个可控堆块

Ripple 20存在于Treck TCP/IP协议栈中，该协议栈广泛存在于嵌入式设备中，波及的行业包括：工业设备、电力设备、企业网络设备、交通、能源等等，而上述设施我们称之为：关键基础设施
Ripple 20不好修补，首先由于供应链的广泛传播，漏洞存在形式又很底层，所以排查设备是否运行Treck TCP/IP协议栈容易疏漏。其次虽然Treck官方已经提供了最新稳定版本6.0.1.67，但是这种基础协议栈软件的更新还是比较麻烦的
从白皮书披露来看，漏洞利用技术并不十分复杂，所以漏洞利用门槛可能不会很高，例如这个漏洞，即使无法做到RCE，至少远程令设备crash是比较容易做到的，而关键基础设施的crash也已经算是大问题了
